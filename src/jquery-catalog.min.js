(function(a,b){if(typeof define==="function"&&define.cmd){define(function(){b(jQuery,window)})}else{if(typeof define==="function"&&define.amd){define(["catalog"],b(jQuery,window))}else{window.tocify=b(jQuery,window)}}})(this,function(c,b){var d={container:"body",data:[{item:"",title:""}]};function a(f,e){c(f).data("cat",this);this.element=c(f);this.options=c.extend({},d,e);this.init()}a.prototype={init:function(){var e=this;e.$index=0;e.$top=[];e.defend=true;e.containTop=e.element.offset().top;e.containerInit();e.createElement();e.bindEvent(e.containTop);e.winScroll(e.containTop)},containerInit:function(){var e=this;e.element.html("");if(e.element.prop("class").indexOf("tocify")===-1){e.element.addClass("tocify")}},createElement:function(){var e=this;e.dataParse(e.options.container,e.options.data,e.element,function(f){f.append("<ul class='tocify-header nav nav-list'></ul>");return f.children("ul").last()},function(i,h,g,f){i.append("<li class='tocify-item' data-selector='"+f.item+"' data-id='"+h+"'><a>"+g.find(f.title).text()+"</a></li>");g.attr("data-hash",h);e.$top[h]=g.offset().top;e.$index++})},dataParse:function(l,h,i,k,j){var m=this,e=JSON.parse(JSON.stringify(h)),g=e.shift(),f;f=k.call(m,i)||i;c(l).find(g.item).each(function(o,p){var n=m.$index;j.call(m,f,n,c(p),g);if(e.length>0){m.dataParse(p,e,f,k,j)}})},bindEvent:function(f){var e=this;e.scrollEvent(e.element.offset().top);e.element.off("click").on("click","li",function(){var h=c(this),g=h.data("selector")+"[data-hash='"+h.data("id")+"']",i=c(e.options.container).find(g);e.defend=false;e.changeActive(h);e.scrollSmooth(i.offset().top-15,c(b).scrollTop(),f)})},changeActive:function(f){var e=this;e.element.find("li").removeClass("active");f.addClass("active");c.each(e.element.find("ul").splice(1,e.element.find("ul").length-1),function(g,h){if(c(h).find(".active").length===0&&c(h).prev("li").prop("class").indexOf("active")===-1){c(h).slideUp("ease")}else{c(h).slideDown("ease")}})},scrollSmooth:function(i,e,h){var g=this,f,j=i-e;if(j!=0){g.defend=false;f=setInterval(function(){if(j>0&&i-e<j/20||j<0&&i-e>j/20){b.scroll(0,i);clearInterval(f);g.defend=true}else{e+=j/20;b.scroll(0,e);if(h-e<15){g.element.css({position:"fixed",top:"15px"})}}},10)}},winScroll:function(f){var e=this;c(b).scroll(function(){e.defend?e.scrollEvent(f):false})},scrollEvent:function(g){var f=this,e=c(b).scrollTop(),h=g-e;if(h<15){f.element.css({position:"fixed",top:"15px"})}else{if(h>15){f.element.css({position:"relative",top:"0"})}}f.$top.forEach(function(k,j){if(j>0&&f.$top[j+1]>e+15&&k<=e+15){f.changeActive(c(f.element).find("li[data-id='"+j+"']"));return false}else{if(j===0&&f.$top[0]>=e+15){f.changeActive(c(f.element).find("li[data-id='0']"));return false}}})}};c.fn.catalog=function(f){var e;if(typeof f==="object"){return this.each(function(){new a(this,f)})}else{if(f==="refresh"){e=c(this).data("cat");e.$index=0;e.$top=[];e.defend=true;e.containTop=e.element.offset().top;e.containerInit();e.createElement()}else{if(f==="destroy"){e=c(this).data("cat");c(b).off("scroll");e.element.html("").removeClass("tocify")}}}}});
